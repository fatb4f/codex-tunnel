# codex-tunnel SSH certificate auth hardening
#
# Install as:
#   /etc/ssh/sshd_config.d/50-codex-tunnel-certauth.conf
#
# Then:
#   sudo sshd -t
#   sudo systemctl reload sshd

# Disable password auth; use keys/certs only.
PasswordAuthentication no
KbdInteractiveAuthentication no
PubkeyAuthentication yes

# User CA used to validate SSH user certificates.
TrustedUserCAKeys /etc/ssh/trusted_user_ca_keys.pub

# Principals mapping per local user.
AuthorizedPrincipalsFile /etc/ssh/auth_principals/%u

# Keep root login disabled.
PermitRootLogin no

# Tighten SSH defaults.
PermitEmptyPasswords no
AllowAgentForwarding no
AllowTcpForwarding no
X11Forwarding no
PermitTunnel no
MaxAuthTries 3
LoginGraceTime 20
ClientAliveInterval 300
ClientAliveCountMax 2
